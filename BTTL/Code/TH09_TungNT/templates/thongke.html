<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Th·ªëng k√™ ƒê∆°n H√†ng</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f4f4f4;
            text-align: center;
        }
        h1 {
            color: #333;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background: #3498db;
            color: white;
        }
        tr:hover {
            background: #f1f1f1;
        }
        .order-details {
            display: none;
            text-align: left;
        }
        button {
            margin-top: 10px;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            color: white;
        }
        .btn-primary {
            background: #3498db;
        }
        .btn-primary:hover {
            background: #2980b9;
        }
        .btn-export {
            background: #2ecc71;
        }
        .btn-export:hover {
            background: #27ae60;
        }
    </style>
</head>
<body>
    <header>
        <h1>Th·ªëng k√™ ƒê∆°n H√†ng</h1>
        <nav>
            <a href="{{ url_for('index') }}">
                <button class="btn-primary">Trang ch·ªß</button>
            </a>
            <a href="{{ url_for('categories') }}">
                <button class="btn-primary">Danh M·ª•c</button>
            </a>
            <a href="{{ url_for('orders') }}">
                <button class="btn-primary">ƒê∆°n h√†ng</button>
            </a>
        </nav>
    </header>

    <!-- N√∫t Xu·∫•t Excel -->
    <button class="btn-export" onclick="exportToExcel()">üìä Xu·∫•t Excel</button>

    <table id="orderTable">
        <thead>
            <tr>
                <th>ID ƒê∆°n H√†ng</th>
                <th>Ng∆∞·ªùi D√πng</th>
                <th>T·ªïng Ti·ªÅn</th>
                <th>S·ªë L∆∞·ª£ng</th>
                <th>Chi Ti·∫øt</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr onclick="toggleDetails('order-{{ order.id }}')">
                <td>{{ order.id }}</td>
                <td>{{ order.user_id }}</td>
                <td>{{ order.total }} VND</td>
                <td>{{ order.quantity }}</td>
                <td><button class="btn-primary">Chi ti·∫øt</button></td>
            </tr>
            <tr id="order-{{ order.id }}" class="order-details">
                <td colspan="5">
                    <h3>Chi ti·∫øt ƒë∆°n h√†ng:</h3>
                    <table width="100%">
                        <thead>
                            <tr>
                                <th>S·∫£n ph·∫©m</th>
                                <th>S·ªë l∆∞·ª£ng</th>
                                <th>Gi√°</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.items %}
                            <tr>
                                <td>{{ item.product.name }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>{{ item.price }} VND</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <a href="/">Quay l·∫°i</a>

    <script>
        // Hi·ªÉn th·ªã ho·∫∑c ·∫©n chi ti·∫øt ƒë∆°n h√†ng
        function toggleDetails(id) {
            var row = document.getElementById(id);
            row.style.display = (row.style.display === "table-row") ? "none" : "table-row";
        }

        // Xu·∫•t b·∫£ng ra file Excel
        function exportToExcel() {
            let table = document.getElementById("orderTable");
            let wb = XLSX.utils.table_to_book(table, { sheet: "Thong_Ke_Don_Hang" });
            XLSX.writeFile(wb, "Thong_Ke_Don_Hang.xlsx");
        }
    </script>

</body>
</html>
